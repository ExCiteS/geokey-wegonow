<!DOCTYPE html>

<!--[if IE 7]><html lang="en" class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html lang="en" class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><html lang="en" class="no-js"><![endif]-->
    <head>

        <title>{{ PLATFORM_NAME }} {% if error %}| {{ error }}{% else %}{% block title %}{% endblock %}{% endif%}</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="Platform for participatory mapping, developed by ExCiteS at University College London." />

        <link rel="stylesheet" href="/static/material/lib/bootstrap.min.css">
        <link rel="stylesheet" href="/static/material/css/admin.css">
        <script src="/static/lib/modernizr/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/static/lib/jquery/jquery-1.12.0.min.js"><\/script>');</script>

        {% include 'material/includes/material_css.html' %}
        {% include 'material/includes/material_js.html' %}
    </head>

    <body {% block bodydata %}{% endblock %}>
        {% include 'snippets/navigation.html' %}

        <div id="content">
            {% if error %}
                {% include 'snippets/error.html' %}
            {% else %}
                {% block main %}{% endblock %}
            {% endif %}
        </div>

        {% include 'snippets/footer.html' %}

        {% include 'snippets/google_analytics.html' %}

        {% if not error %}
            {% block modals %}{% endblock %}
            {% block libraries %}{% endblock %}
        {% endif %}
    </body>
<script>

function checkWeGovNowSession(callback) {
    var xhr = new XMLHttpRequest();
    var url = "https://wegovnow.liquidfeedback.com/api/1/session";
    xhr.open("POST", url, true);
    xhr.withCredentials = true; // sends UWUM cookies to UWUM (important)
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
            if (xhr.status == 200) {
                console.log ("XHR", xhr)
                var r = JSON.parse(xhr.responseText);
                console.log("RRR:", r)
                callback(r.member_id);
            } else {
                // some error occured, add error handling
                callback(undefined);
            }
        }
    }
    xhr.send();
}

checkWeGovNowSession(function(result) {
 if (result === undefined) { // note === to distinguish undefined from null 
   console.log("Error during request")
 } else if (result) {
   console.log("Web browser claims that a user with the following ID is logged in: " + result); 
 } else {
   console.log("Web browser claims that no user is logged in.!!");
 }
});


</script>

</html>
